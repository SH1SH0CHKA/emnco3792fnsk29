<div id="settings-mmodal" class="modal-bg hidden">
  <div class="modal-window bg-primary-1100 flex flex-col">
    <div class="flex items-center mb-2">
      <div class="modal-caption grow">Настройки</div>
      <button
        type="button"
        class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ml-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white"
        onclick="FrogUI.goHomeSection()"
      >
        <span class="material-symbols-rounded">close</span>
      </button>
    </div>

    <!-- Memory setup -->
    <div class="flex my-3">
      <p>Выделение памяти (Гб)</p>
      <span
        class="material-symbols-rounded text-primary-700 ml-3"
        id="showMemTooltip"
        >help</span
      >
    </div>

    <input
      type="number"
      id="memInput"
      class="custom-input"
      min="0.5"
      step="0.5"
    />

    <!-- Java version selector -->
    <p class="my-3">Версия Java</p>
    <select class="custom-input" id="javaSelect"></select>

    <!-- Game directory setup -->
    <p class="my-3">Папка для хранения файлов игры</p>
    <div
      class="flex items-center"
    >
      <input
        type="text"
        class="custom-input"
        readonly
        style="height: 48px;"
        id="gamePathInput"
      />
      <button
        id="selectPathButton" class="bg-primary-1000 rounded-lg ml-3 p-0" style="width: 48px; height: 48px;"
        onclick="openGameDirectoryDialog(false)"
      >
        <span class="material-symbols-rounded" style="padding-top: 4px;">folder_open</span>
      </button>
    </div>

    <div class="grow"></div>

    <button class="custom-button" onclick="saveMainSettings()">Сохранить настройки</button>
  </div>
  <div
    id="memTooltip"
    class="setup-tooltip flex items-center justify-center hidden"
  >
    <span class="material-symbols-rounded text-white">memory_alt</span>
    <span class="ml-3 text-white"
      >Рекомендуем выделять
      <span class="text-green-500">не менее 1.5 Гб</span> для ванильной версии и
      <span class="text-blue-500">не менее 4 Гб</span> для версии с
      модификациями</span
    >
  </div>
</div>

<style>
  .setup-tooltip {
    position: absolute;
    left: 0;
    right: 0;
    top: 0;
    bottom: 0;
    width: max-content;
    height: max-content;
    padding: 24px;
    border-radius: 12px;
    background: var(--bg-primary-1000);
    z-index: 20;
    width: 380px;
    pointer-events: none;
  }

  .setup-tooltip .material-symbols-rounded {
    font-size: 20pt;
  }

  input,
  select {
    width: 100%;
  }
</style>

<script>
  const AUTO_JAVA_ITEM =
    "<option value='auto'>Автоматически скачать и использовать подходящую версию</option>";

  $("#showMemTooltip").hover(function () {
    FrogUI.refreshAbsoluteElementsPositions();
    $("#memTooltip").removeClass("hidden");
    animateCSS("#memTooltip", "fadeIn");
  });

  $("#showMemTooltip").mouseleave(function () {
    $("#memTooltip").addClass("hidden");
  });

  $(document).ready(function () {
    // Loading Java list
    $("#javaSelect").append(AUTO_JAVA_ITEM);
    FrogInfo.getJavaBinariesList().forEach((element) => {
      $("#javaSelect").append(
        "<option value='" + element + "'>" + element + "</option>"
      );
    });

    // Refreshing memory input max and val
    $("#memInput").val(mainConfig.selectedMemorySize);
    $("#memInput").attr("max", (FrogInfo.getMaxRAMSize() / 1024).toFixed(1));

    // Refreshing Java select
    if (mainConfig.selectedJava == "auto") {
      $("#javaSelect option[value='auto']").prop("selected", true);
    } else {
      if (
        $("#javaSelect option[value='" + mainConfig.selectedJava + "']")
          .length > 0
      ) {
        $("#javaSelect option[value='" + mainConfig.selectedJava + "']").prop(
          "selected",
          true
        );
      } else {
        $("#javaSelect option[value='auto']").prop("selected", true);
        mainConfig.selectedJava = "auto";
        FrogConfigManager.writeAndRefreshMainConfig(mainConfig);
      }
    }

    // Refreshing game path
    $("#gamePathInput").val(mainConfig.selectedBaseDirectory);

    // Securing memInput from entering value bigger than max
    $("#memInput").change(function () {
      if ($(this).val() > parseInt($(this).attr("max"))) {
        $(this).val(parseInt($(this).attr("max")));
      }
      if ($(this).val() < $(this).attr("min")) {
        $(this).val($(this).attr("min"));
      }
    });
  });

  function saveMainSettings() {
    mainConfig.selectedJava = $("#javaSelect option:selected").val();
    mainConfig.selectedMemorySize = $("#memInput").val();
    mainConfig.selectedBaseDirectory = $("#gamePathInput").val();
    FrogConfigManager.writeAndRefreshMainConfig(mainConfig);
    Toaster("Настройки успешно сохранены", 3500, true, "success");
  }
</script>
